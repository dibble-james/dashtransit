@page "/message/send"
<DTPageTitle>Send</DTPageTitle>
@using System.Linq.Expressions
@using DashTransit.Core.Application.Commands
@using System.ComponentModel.DataAnnotations
@inject IMediator Mediator
@inject IHxMessengerService Messenger

@code {
    public class SendState
    {
        [Required]
        public string Endpoint { get; set; } = null!;
        [Required]
        public string MessageType { get; set; } = null!;
        [Required]
        public string Message { get; set; } = null!;
    }

    private SendState state = new SendState();

    public async Task Sender()
    {
        try
        {
            await this.Mediator.Send(new SendMessage(EndpointId.From(new Uri(state.Endpoint)), state.MessageType, state.Message));
            this.Messenger.AddInformation("Send", $"Message Sent");
        }
        catch(Exception ex)
        {
            this.Messenger.AddError("Send", $"Couldn't send message {ex}");
        }
    }
}

<EditForm Model="state" OnValidSubmit="Sender">
    <DataAnnotationsValidator />
    <HxInputText Label="Endpoint" @bind-Value="@state.Endpoint" />
    <HxInputText Label="Message Type" @bind-Value="@state.MessageType" />
    <HxInputTextArea Label="Message" @bind-Value="@state.Message" />
    <HxSubmit Color="ThemeColor.Primary">Send</HxSubmit>
</EditForm>